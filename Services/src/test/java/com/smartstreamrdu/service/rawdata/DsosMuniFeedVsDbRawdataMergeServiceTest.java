package com.smartstreamrdu.service.rawdata;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNull;

import org.json.simple.JSONObject;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import com.smartstreamrdu.domain.Record;
import com.smartstreamrdu.persistence.mongodb.MongoConfig;
import com.smartstreamrdu.service.jsonconverter.JsonConverterUtil;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(classes = { MongoConfig.class })
public class DsosMuniFeedVsDbRawdataMergeServiceTest {
	
	@Autowired
	@Qualifier("DsosMuniFeedVsDbRawdataMergeService")
	private FeedVsDbRawdataMergeService feedVsDbMergeService;
	
	/*
	 * Test case to merge feed asset object with db asset object.
	 * Here, cusip from feed will merge with db object.
	 */
	@Test
	public void testMergeAssetDelta() {
		String muniDbJson = "{\"muni\":{\"asset2\":{\"prtl_redemp_fl\":\"\",\"callable_notation\":\"\",\"repo_elig_id\":\"\",\"cusip_change_cd\":\"\",\"toggle_note_fl\":\"n\",\"instr_name\":\"8.5% FIX MTN DUE 2023\",\"asset_id\":\"0x00102caebb6f1554\",\"cur_cpn_class_cd\":\"FIX\",\"flip_opt_fl\":\"y\",\"straight_bond_fl\":\"n\",\"risk_country_cd\":\"\",\"sukuk_structure_fl\":\"\",\"prin_pay_redempt_cd\":\"\",\"fdic_insu_fl\":\"\",\"post_iss_icma_fl\":\"\",\"latest_iss_px\":\"100.0\",\"write_down_trigger_cd\":\"\",\"crd_compliance_fl\":\"\",\"dfrd_int_cnvrsn_dt\":\"\",\"trade_settle_curr_cd\":\"\",\"facility_amt\":\"\",\"aaoifi_compliant_fl\":\"\",\"hybrid_fl\":\"n\",\"next_par_call_dt\":\"\",\"odd_first_cpn_cd\":\"R\",\"liquidation_preference_cd\":\"SRU\",\"write_up_fl\":\"\",\"odd_first_cpn\":\"\",\"announcement_dt\":\"2018-08-23 02:39:00.0\",\"flip_opt_dt\":\"2021-08-29 00:00:00.0\",\"transition_bond_fl\":\"n\",\"green_bond_fl\":\"n\",\"sharia_opinion_fl\":\"\",\"gen_pay_rank_cd\":\"SEU\",\"conver_cd\":\"\",\"seniority_cd\":\"SR\",\"us_baby_bond_fl\":\"\",\"puttable_notation\":\"5np3(1x)\",\"orig_cusip_type_cd\":\"\",\"tax_credit_fl\":\"n\",\"cfi\":\"DBFXFR\",\"realtime_bond_type\":\"S\",\"debt_recourse_cd\":\"Y\",\"dtc_elig_fl\":\"\",\"us_section_13f_fl\":\"n\",\"trading_flat_fl\":\"\",\"esg_icma_fl\":\"\",\"odd_last_cpn_fl\":\"n\",\"esg_label_cd\":\"\",\"retail_sec_fl\":\"n\",\"eu_taxonomy_fl\":\"\",\"fisn\":\"OCEANWIDE/8.5 Dbt Fing Instr\",\"series\":\"\",\"tlac_elig_fl\":\"\",\"div_stopper_fl\":\"\",\"facility\":\"\",\"ftt_liable_fl\":\"n\",\"next_par_call_px\":\"\",\"reoffered_dt\":\"\",\"src_of_pmt_cd\":\"\",\"over_subscription\":\"\",\"bailin_fl\":\"\",\"cur_rate_cd\":\"N\",\"flip_opt_cd\":\"IO\",\"cav_maturity_amt\":\"\",\"esg_compliance_cd\":\"\",\"ftt_report_fl\":\"n\",\"org_of_risk_id\":\"\",\"latest_iss_dt\":\"2018-08-27 00:00:00.0\",\"cur_amt_factor\":\"1.0\",\"security_cd\":\"\",\"odd_first_cpn_fl\":\"n\",\"div_pusher_fl\":\"\",\"ucits_compliance_fl\":\"\",\"prerefunded_fl\":\"\",\"structured_fl\":\"n\",\"term_to_maturity_yrs\":\"5Y\",\"reoffered_fl\":\"\",\"isa_eligible_fl\":\"n\",\"repo_elig_fl\":\"n\",\"rrps_ric_permid\":\"46667052112\",\"org_of_risk_audit_cd\":\"\",\"tier_capital_cd\":\"\",\"cic_cd\":\"CN29\",\"survivor_opt_fl\":\"n\",\"odd_last_cpn_cd\":\"R\",\"local_iss_dt\":\"\",\"write_down_trigg_ratio\":\"\",\"cdc_asset_class_cd\":\"MTN\",\"letter_of_credit_fl\":\"n\",\"structured_cd\":\"\",\"estimated_free_cnv_fl\":\"\",\"borrower_id\":\"\",\"cusip_change_dt\":\"\",\"finra_sub_prdct_type_cd\":\"\",\"solvability_ratio\":\"\",\"cleanup_call_fl\":\"n\",\"cntry_of_risk_cd\":\"\",\"cur_int_defer_fl\":\"n\",\"risk_classifications_cd\":\"\",\"trade_asset_type_cd\":\"\",\"make_whole_call_fl\":\"n\",\"write_down_fl\":\"\",\"issue_id\":\"\",\"esg_bond_fl\":\"n\",\"calc_disable_rsn\":\"\",\"qdi_elig_fl\":\"n\",\"write_down_type_cd\":\"\",\"super_sinker_fl\":\"\",\"asset_eff_dt\":\"2018-08-27 00:00:00.0\",\"realtime_building_block\":\"CORP\",\"pgm_iss_fl\":\"y\",\"addl_credit_fl\":\"\",\"mrel_elig_fl\":\"\",\"drd_elig_fl\":\"n\",\"cap_cont_fl\":\"n\"},\"asset\":{\"current_cpn\":\"8.5\",\"wpk_nm\":\"\",\"funged_fl\":\"n\",\"bankwatch_rating_dt\":\"\",\"latest_rating_src_cd\":\"\",\"asset_id\":\"0x00102caebb6f1554\",\"asset_status_cd\":\"DEF\",\"ibs_control_nm\":\"\",\"project_name\":\"\",\"emerging_market_fl\":\"n\",\"last_reset_dt\":\"\",\"mandatory_tender_dt\":\"\",\"mdy_rating_cd\":\"\",\"unit_cd\":\"\",\"next_sink_dt\":\"\",\"strip_total\":\"\",\"capitalization_fl\":\"n\",\"next_put_dt\":\"\",\"dom_settle_val\":\"1\",\"pay_freq_cd\":\"1\",\"mdy_rating_dt\":\"\",\"cur_prin_leg_nm\":\"1\",\"debt_svc_cd\":\"\",\"put_terms_fl\":\"y\",\"tot_prog_amt\":\"\",\"mdy_st_rtng_dt\":\"\",\"dcs_type_cd\":\"B\",\"next_pay_dt\":\"\",\"asset_setup_dt\":\"2018-08-23 02:39:00.0\",\"cur_amt_outsd\":\"700000.0\",\"trace_cd\":\"N\",\"next_reset_dt\":\"\",\"strippable_fl\":\"n\",\"day_count_cd\":\"5\",\"ibca_rating_dt\":\"\",\"rtfi_us_elig_cd\":\"SEA\",\"tap_end_dt\":\"\",\"status_of_document\":\"2\",\"exdiv_val\":\"\",\"asset_duplicate_cd\":\"\",\"valoren_nm\":\"\",\"life_cap\":\"\",\"pay_in_part_fl\":\"n\",\"oid_fl\":\"\",\"prospectus_dt\":\"2018-08-27 00:00:00.0\",\"mdy_watch_cd\":\"\",\"credit_sensitive_fl\":\"n\",\"dp_rating_dt\":\"\",\"lead_undwrt_cd\":\"\",\"sp_rating_cd\":\"\",\"clawback_type_cd\":\"\",\"min_denom\":\"100.0\",\"call_terms_fl\":\"n\",\"call_type_cd\":\"\",\"mdy_watch_dt\":\"\",\"sp_st_rtng_cd\":\"\",\"nsin_nm\":\"CND10001ZXY6\",\"float_mult\":\"\",\"min_credit_rating_cd\":\"AA-\",\"native_yld_type_cd\":\"CB\",\"asset_ticker\":\"OWREP\",\"fitch_rating_cd\":\"\",\"asset_templt_cd\":\"CC\",\"bankwatch_rating_cd\":\"\",\"annuity_fl\":\"n\",\"cpn_type_cd\":\"FXPV\",\"refund_dt\":\"\",\"status_eff_dt\":\"2021-08-29 00:00:00.0\",\"convertible_fl\":\"n\",\"tap_issue_fl\":\"n\",\"asset_permid\":\"192809957069\",\"latest_rating_eff_dt\":\"\",\"cur_amt_outsd_chg_cd\":\"ISS\",\"prosp_on_file_fl\":\"y\",\"sovr_class_cd\":\"\",\"sp_watch_dt\":\"\",\"dom_settle_cal_cd\":\"BDY\",\"last_cpn_dt\":\"2022-08-29 00:00:00.0\",\"redemption_val\":\"100.0\",\"orig_iss_dt\":\"2018-08-27 00:00:00.0\",\"record_dt_val\":\"\",\"stick_suppl_fl\":\"n\",\"exdiv_cal_cd\":\"\",\"multistep_flt_fl\":\"n\",\"dp_rating_cd\":\"\",\"float_offset\":\"\",\"cur_prin_curr_cd\":\"CNY\",\"secondary_insu_fl\":\"\",\"issuer_id\":\"0x000405016f81ce20\",\"record_dt_cd\":\"\",\"common_code_nm\":\"\",\"next_sink_amt\":\"\",\"orig_amt_iss\":\"700000.0\",\"series\":\"\",\"fitch_ibca_rating_cd\":\"\",\"tax_call_fl\":\"n\",\"asset_cf_corr_dt\":\"\",\"descr_detail\":\"\",\"er_score\":\"4\",\"prosp_suppl_dt\":\"\",\"rrps_ric\":\"CN101800969=RRPS\",\"domin_rating_cd\":\"\",\"exch_listed_fl\":\"y\",\"ibca_rating_cd\":\"\",\"next_call_px\":\"\",\"primary_quote_id\":\"00102C6F478A158B\",\"fitch_rating_dt\":\"\",\"cusip\":\"001765AG1\",\"pik_inkind_pmt_dt\":\"\",\"tax_status_cd\":\"\",\"equity_clawback_fl\":\"n\",\"amt_iss_tot\":\"700000.0\",\"next_call_dt\":\"\",\"physical_form_cd\":\"BKE\",\"isin_nm\":\"CND10001ZXY6\",\"mtn_shelf_id\":\"0x00102c40d75f0df9\",\"full_bridge_symbol\":\"cn*;OWREP-8.5-0823\",\"pik_fl\":\"n\",\"ds_subtype_cd\":\"CFIN\",\"life_floor\":\"\",\"domin_rating_dt\":\"\",\"fitch_ibca_rating_dt\":\"\",\"pay_cal_cd\":\"CDM\",\"first_cpn_dt\":\"2019-08-29 00:00:00.0\",\"maturity_dt\":\"2023-08-29 00:00:00.0\",\"dual_cur_fl\":\"n\",\"first_reset_dt\":\"\",\"cur_int_leg_nm\":\"1\",\"next_put_px\":\"\",\"distribution_src_cd\":\"RTRI\",\"perpetual_fl\":\"n\",\"cpn_class_cd\":\"FIX\",\"latest_rating_cd\":\"\",\"sp_st_rtng_dt\":\"\",\"bridge_symbol\":\"OWREP-8.5-0823\",\"dbs_pid\":\"110000B0313QH\",\"int_idx_lnk_fl\":\"\",\"float_index\":\"\",\"debt_type_cd\":\"SRNT\",\"prosp_suppl_nm\":\"\",\"sec_class_cd\":\"\",\"descr\":\"OWREP  8.500 08/29/23 MTN DFTd\",\"sp_watch_cd\":\"\",\"cntry_of_iss_cd\":\"CN\",\"sp_rating_dt\":\"\",\"eusd_tax_fl\":\"y\",\"currency_cd\":\"CNY\",\"withholding_tax\":\"\",\"orig_dated_dt\":\"2018-08-29 00:00:00.0\",\"exec_quote_fl\":\"n\",\"warrants_fl\":\"n\",\"sp_debt_class_cd\":\"\",\"private_place_fl\":\"n\",\"nsin_agn_cd\":\"ISN\",\"mtn_fl\":\"y\",\"denom_type_cd\":\"BKE\",\"euroclear_nm\":\"\",\"poison_put_fl\":\"n\",\"isin_src_cd\":\"\",\"trace_grade_cd\":\"\",\"asset_subtype_cd\":\"DMTC\",\"amt_iss_public\":\"\",\"asset_type_cd\":\"CORP\",\"defeased_fl\":\"n\",\"settle_bus_ctr_cd\":\"CN\",\"float_formula\":\"\",\"asset_last_chg_dt\":\"2023-03-06 17:49:00.0\",\"standard_yld_type_cd\":\"IS\",\"denom_incr\":\"100.0\",\"asset_info_src_cd\":\"RTR\",\"mdy_st_rtng_cd\":\"\",\"spec_put_fl\":\"n\",\"prin_idx_lnk_fl\":\"n\",\"guarantee_fl\":\"n\",\"pay_cal_val\":\"29\",\"fund_terms_fl\":\"n\",\"mdy_debt_class_cd\":\"\",\"pik_csh_pmt_dt\":\"\",\"bank_qualified_fl\":\"\",\"exp_maturity_dt\":\"\",\"secured_fl\":\"n\",\"for_settle_val\":\"\",\"next_mand_tender_dt\":\"\",\"fig_rule_cd\":\"C\",\"rtr_ticker\":\"OWREP\",\"rcs_class_cd\":\"BOND\",\"extend_terms_fl\":\"n\",\"preferred_ric\":\"CN101800969=\",\"ds_type_cd\":\"CORP\",\"inflation_protect_fl\":\"n\",\"cur_amt_out_dt\":\"2018-08-27 00:00:00.0\"}}}";
		String muniFeedJson = "{\"muni\":{\"asset2\":{\"prtl_redemp_fl\":\"\",\"callable_notation\":\"\",\"repo_elig_id\":\"\",\"cusip_change_cd\":\"\",\"toggle_note_fl\":\"n\",\"instr_name\":\"8.5% FIX MTN DUE 2023\",\"asset_id\":\"0x00102caebb6f1554\",\"cur_cpn_class_cd\":\"FIX\",\"flip_opt_fl\":\"y\",\"straight_bond_fl\":\"n\",\"risk_country_cd\":\"\",\"sukuk_structure_fl\":\"\",\"prin_pay_redempt_cd\":\"\",\"fdic_insu_fl\":\"\",\"post_iss_icma_fl\":\"\",\"latest_iss_px\":\"100.0\",\"write_down_trigger_cd\":\"\",\"crd_compliance_fl\":\"\",\"dfrd_int_cnvrsn_dt\":\"\",\"trade_settle_curr_cd\":\"\",\"facility_amt\":\"\",\"aaoifi_compliant_fl\":\"\",\"hybrid_fl\":\"n\",\"next_par_call_dt\":\"\",\"odd_first_cpn_cd\":\"R\",\"liquidation_preference_cd\":\"SRU\",\"write_up_fl\":\"\",\"odd_first_cpn\":\"\",\"announcement_dt\":\"2018-08-23 02:39:00.0\",\"flip_opt_dt\":\"2021-08-29 00:00:00.0\",\"transition_bond_fl\":\"n\",\"green_bond_fl\":\"n\",\"sharia_opinion_fl\":\"\",\"gen_pay_rank_cd\":\"SEU\",\"conver_cd\":\"\",\"seniority_cd\":\"SR\",\"us_baby_bond_fl\":\"\",\"puttable_notation\":\"5np3(1x)\",\"orig_cusip_type_cd\":\"\",\"tax_credit_fl\":\"n\",\"cfi\":\"DBFXFR\",\"realtime_bond_type\":\"S\",\"debt_recourse_cd\":\"Y\",\"dtc_elig_fl\":\"\",\"us_section_13f_fl\":\"n\",\"trading_flat_fl\":\"\",\"esg_icma_fl\":\"\",\"odd_last_cpn_fl\":\"n\",\"esg_label_cd\":\"\",\"retail_sec_fl\":\"n\",\"eu_taxonomy_fl\":\"\",\"fisn\":\"OCEANWIDE/8.5 Dbt Fing Instr\",\"series\":\"\",\"tlac_elig_fl\":\"\",\"div_stopper_fl\":\"\",\"facility\":\"\",\"ftt_liable_fl\":\"n\",\"next_par_call_px\":\"\",\"reoffered_dt\":\"\",\"src_of_pmt_cd\":\"\",\"over_subscription\":\"\",\"bailin_fl\":\"\",\"cur_rate_cd\":\"N\",\"flip_opt_cd\":\"IO\",\"cav_maturity_amt\":\"\",\"esg_compliance_cd\":\"\",\"ftt_report_fl\":\"n\",\"org_of_risk_id\":\"\",\"latest_iss_dt\":\"2018-08-27 00:00:00.0\",\"cur_amt_factor\":\"1.0\",\"security_cd\":\"\",\"odd_first_cpn_fl\":\"n\",\"div_pusher_fl\":\"\",\"ucits_compliance_fl\":\"\",\"prerefunded_fl\":\"\",\"structured_fl\":\"n\",\"term_to_maturity_yrs\":\"5Y\",\"reoffered_fl\":\"\",\"isa_eligible_fl\":\"n\",\"repo_elig_fl\":\"n\",\"rrps_ric_permid\":\"46667052112\",\"org_of_risk_audit_cd\":\"\",\"tier_capital_cd\":\"\",\"cic_cd\":\"CN29\",\"survivor_opt_fl\":\"n\",\"odd_last_cpn_cd\":\"R\",\"local_iss_dt\":\"\",\"write_down_trigg_ratio\":\"\",\"cdc_asset_class_cd\":\"MTN\",\"letter_of_credit_fl\":\"n\",\"structured_cd\":\"\",\"estimated_free_cnv_fl\":\"\",\"borrower_id\":\"\",\"cusip_change_dt\":\"\",\"finra_sub_prdct_type_cd\":\"\",\"solvability_ratio\":\"\",\"cleanup_call_fl\":\"n\",\"cntry_of_risk_cd\":\"\",\"cur_int_defer_fl\":\"n\",\"risk_classifications_cd\":\"\",\"trade_asset_type_cd\":\"\",\"make_whole_call_fl\":\"n\",\"write_down_fl\":\"\",\"issue_id\":\"\",\"esg_bond_fl\":\"n\",\"calc_disable_rsn\":\"\",\"qdi_elig_fl\":\"n\",\"write_down_type_cd\":\"\",\"super_sinker_fl\":\"\",\"asset_eff_dt\":\"2018-08-27 00:00:00.0\",\"realtime_building_block\":\"CORP\",\"pgm_iss_fl\":\"y\",\"addl_credit_fl\":\"\",\"mrel_elig_fl\":\"\",\"drd_elig_fl\":\"n\",\"cap_cont_fl\":\"n\"},\"asset\":{\"current_cpn\":\"8.5\",\"wpk_nm\":\"\",\"funged_fl\":\"n\",\"bankwatch_rating_dt\":\"\",\"latest_rating_src_cd\":\"\",\"asset_id\":\"0x00102caebb6f1554\",\"asset_status_cd\":\"DEF\",\"ibs_control_nm\":\"\",\"project_name\":\"\",\"emerging_market_fl\":\"n\",\"last_reset_dt\":\"\",\"mandatory_tender_dt\":\"\",\"mdy_rating_cd\":\"\",\"unit_cd\":\"\",\"next_sink_dt\":\"\",\"strip_total\":\"\",\"capitalization_fl\":\"n\",\"next_put_dt\":\"\",\"dom_settle_val\":\"1\",\"pay_freq_cd\":\"1\",\"mdy_rating_dt\":\"\",\"cur_prin_leg_nm\":\"1\",\"debt_svc_cd\":\"\",\"put_terms_fl\":\"y\",\"tot_prog_amt\":\"\",\"mdy_st_rtng_dt\":\"\",\"dcs_type_cd\":\"B\",\"next_pay_dt\":\"\",\"asset_setup_dt\":\"2018-08-23 02:39:00.0\",\"cur_amt_outsd\":\"700000.0\",\"trace_cd\":\"N\",\"next_reset_dt\":\"\",\"strippable_fl\":\"n\",\"day_count_cd\":\"5\",\"ibca_rating_dt\":\"\",\"rtfi_us_elig_cd\":\"SEA\",\"tap_end_dt\":\"\",\"status_of_document\":\"2\",\"exdiv_val\":\"\",\"asset_duplicate_cd\":\"\",\"valoren_nm\":\"\",\"life_cap\":\"\",\"pay_in_part_fl\":\"n\",\"oid_fl\":\"\",\"prospectus_dt\":\"2018-08-27 00:00:00.0\",\"mdy_watch_cd\":\"\",\"credit_sensitive_fl\":\"n\",\"dp_rating_dt\":\"\",\"lead_undwrt_cd\":\"\",\"sp_rating_cd\":\"\",\"clawback_type_cd\":\"\",\"min_denom\":\"100.0\",\"call_terms_fl\":\"n\",\"call_type_cd\":\"\",\"mdy_watch_dt\":\"\",\"sp_st_rtng_cd\":\"\",\"nsin_nm\":\"CND10001ZXY6\",\"float_mult\":\"\",\"min_credit_rating_cd\":\"AA-\",\"native_yld_type_cd\":\"CB\",\"asset_ticker\":\"OWREP\",\"fitch_rating_cd\":\"\",\"asset_templt_cd\":\"CC\",\"bankwatch_rating_cd\":\"\",\"annuity_fl\":\"n\",\"cpn_type_cd\":\"FXPV\",\"refund_dt\":\"\",\"status_eff_dt\":\"2021-08-29 00:00:00.0\",\"convertible_fl\":\"n\",\"tap_issue_fl\":\"n\",\"asset_permid\":\"192809957069\",\"latest_rating_eff_dt\":\"\",\"cur_amt_outsd_chg_cd\":\"ISS\",\"prosp_on_file_fl\":\"y\",\"sovr_class_cd\":\"\",\"sp_watch_dt\":\"\",\"dom_settle_cal_cd\":\"BDY\",\"last_cpn_dt\":\"2022-08-29 00:00:00.0\",\"redemption_val\":\"100.0\",\"orig_iss_dt\":\"2018-08-27 00:00:00.0\",\"record_dt_val\":\"\",\"stick_suppl_fl\":\"n\",\"exdiv_cal_cd\":\"\",\"multistep_flt_fl\":\"n\",\"dp_rating_cd\":\"\",\"float_offset\":\"\",\"cur_prin_curr_cd\":\"CNY\",\"secondary_insu_fl\":\"\",\"issuer_id\":\"0x000405016f81ce20\",\"record_dt_cd\":\"\",\"common_code_nm\":\"\",\"next_sink_amt\":\"\",\"orig_amt_iss\":\"700000.0\",\"series\":\"\",\"fitch_ibca_rating_cd\":\"\",\"tax_call_fl\":\"n\",\"asset_cf_corr_dt\":\"\",\"descr_detail\":\"\",\"er_score\":\"4\",\"prosp_suppl_dt\":\"\",\"rrps_ric\":\"CN101800969=RRPS\",\"domin_rating_cd\":\"\",\"exch_listed_fl\":\"y\",\"ibca_rating_cd\":\"\",\"next_call_px\":\"\",\"primary_quote_id\":\"00102C6F478A158B\",\"fitch_rating_dt\":\"\",\"cusip\":\"001765AG2\",\"pik_inkind_pmt_dt\":\"\",\"tax_status_cd\":\"\",\"equity_clawback_fl\":\"n\",\"amt_iss_tot\":\"700000.0\",\"next_call_dt\":\"\",\"physical_form_cd\":\"BKE\",\"isin_nm\":\"CND10001ZXY6\",\"mtn_shelf_id\":\"0x00102c40d75f0df9\",\"full_bridge_symbol\":\"cn*;OWREP-8.5-0823\",\"pik_fl\":\"n\",\"ds_subtype_cd\":\"CFIN\",\"life_floor\":\"\",\"domin_rating_dt\":\"\",\"fitch_ibca_rating_dt\":\"\",\"pay_cal_cd\":\"CDM\",\"first_cpn_dt\":\"2019-08-29 00:00:00.0\",\"maturity_dt\":\"2023-08-29 00:00:00.0\",\"dual_cur_fl\":\"n\",\"first_reset_dt\":\"\",\"cur_int_leg_nm\":\"1\",\"next_put_px\":\"\",\"distribution_src_cd\":\"RTRI\",\"perpetual_fl\":\"n\",\"cpn_class_cd\":\"FIX\",\"latest_rating_cd\":\"\",\"sp_st_rtng_dt\":\"\",\"bridge_symbol\":\"OWREP-8.5-0823\",\"dbs_pid\":\"110000B0313QH\",\"int_idx_lnk_fl\":\"\",\"float_index\":\"\",\"debt_type_cd\":\"SRNT\",\"prosp_suppl_nm\":\"\",\"sec_class_cd\":\"\",\"descr\":\"OWREP  8.500 08/29/23 MTN DFTd\",\"sp_watch_cd\":\"\",\"cntry_of_iss_cd\":\"CN\",\"sp_rating_dt\":\"\",\"eusd_tax_fl\":\"y\",\"currency_cd\":\"CNY\",\"withholding_tax\":\"\",\"orig_dated_dt\":\"2018-08-29 00:00:00.0\",\"exec_quote_fl\":\"n\",\"warrants_fl\":\"n\",\"sp_debt_class_cd\":\"\",\"private_place_fl\":\"n\",\"nsin_agn_cd\":\"ISN\",\"mtn_fl\":\"y\",\"denom_type_cd\":\"BKE\",\"euroclear_nm\":\"\",\"poison_put_fl\":\"n\",\"isin_src_cd\":\"\",\"trace_grade_cd\":\"\",\"asset_subtype_cd\":\"DMTC\",\"amt_iss_public\":\"\",\"asset_type_cd\":\"CORP\",\"defeased_fl\":\"n\",\"settle_bus_ctr_cd\":\"CN\",\"float_formula\":\"\",\"asset_last_chg_dt\":\"2023-03-06 17:49:00.0\",\"standard_yld_type_cd\":\"IS\",\"denom_incr\":\"100.0\",\"asset_info_src_cd\":\"RTR\",\"mdy_st_rtng_cd\":\"\",\"spec_put_fl\":\"n\",\"prin_idx_lnk_fl\":\"n\",\"guarantee_fl\":\"n\",\"pay_cal_val\":\"29\",\"fund_terms_fl\":\"n\",\"mdy_debt_class_cd\":\"\",\"pik_csh_pmt_dt\":\"\",\"bank_qualified_fl\":\"\",\"exp_maturity_dt\":\"\",\"secured_fl\":\"n\",\"for_settle_val\":\"\",\"next_mand_tender_dt\":\"\",\"fig_rule_cd\":\"C\",\"rtr_ticker\":\"OWREP\",\"rcs_class_cd\":\"BOND\",\"extend_terms_fl\":\"n\",\"preferred_ric\":\"CN101800969=\",\"ds_type_cd\":\"CORP\",\"inflation_protect_fl\":\"n\",\"cur_amt_out_dt\":\"2018-08-27 00:00:00.0\"}}}";
		JSONObject feedJsonObj = JsonConverterUtil.convertToSimpleJson(muniFeedJson);
		JSONObject dbJsonObj = JsonConverterUtil.convertToSimpleJson(muniDbJson);
		Record feedRecord = new Record();
		feedRecord.getRecordRawData().setRawData(feedJsonObj);
		Record mergedRecord = feedVsDbMergeService.merge(feedRecord, dbJsonObj);
		assertEquals("001765AG2", mergedRecord.getRecordRawData().getRawDataAttribute("$.muni.asset.cusip"));
	}
	
	/*
	 * Test case to merge feed quote (security) array object with db asset object when quote object is absent in db.
	 */
	@Test
	public void testMergeArrayQuoteObj_AddCompleteFeedArrayObjectInDbIfAbsentInDb() {
		String muniDbJson = "{\"muni\":{\"asset2\":{\"prtl_redemp_fl\":\"\",\"callable_notation\":\"\",\"repo_elig_id\":\"\",\"cusip_change_cd\":\"\",\"toggle_note_fl\":\"n\",\"instr_name\":\"8.5% FIX MTN DUE 2023\",\"asset_id\":\"0x00102caebb6f1554\",\"cur_cpn_class_cd\":\"FIX\",\"flip_opt_fl\":\"y\",\"straight_bond_fl\":\"n\",\"risk_country_cd\":\"\",\"sukuk_structure_fl\":\"\",\"prin_pay_redempt_cd\":\"\",\"fdic_insu_fl\":\"\",\"post_iss_icma_fl\":\"\",\"latest_iss_px\":\"100.0\",\"write_down_trigger_cd\":\"\",\"crd_compliance_fl\":\"\",\"dfrd_int_cnvrsn_dt\":\"\",\"trade_settle_curr_cd\":\"\",\"facility_amt\":\"\",\"aaoifi_compliant_fl\":\"\",\"hybrid_fl\":\"n\",\"next_par_call_dt\":\"\",\"odd_first_cpn_cd\":\"R\",\"liquidation_preference_cd\":\"SRU\",\"write_up_fl\":\"\",\"odd_first_cpn\":\"\",\"announcement_dt\":\"2018-08-23 02:39:00.0\",\"flip_opt_dt\":\"2021-08-29 00:00:00.0\",\"transition_bond_fl\":\"n\",\"green_bond_fl\":\"n\",\"sharia_opinion_fl\":\"\",\"gen_pay_rank_cd\":\"SEU\",\"conver_cd\":\"\",\"seniority_cd\":\"SR\",\"us_baby_bond_fl\":\"\",\"puttable_notation\":\"5np3(1x)\",\"orig_cusip_type_cd\":\"\",\"tax_credit_fl\":\"n\",\"cfi\":\"DBFXFR\",\"realtime_bond_type\":\"S\",\"debt_recourse_cd\":\"Y\",\"dtc_elig_fl\":\"\",\"us_section_13f_fl\":\"n\",\"trading_flat_fl\":\"\",\"esg_icma_fl\":\"\",\"odd_last_cpn_fl\":\"n\",\"esg_label_cd\":\"\",\"retail_sec_fl\":\"n\",\"eu_taxonomy_fl\":\"\",\"fisn\":\"OCEANWIDE/8.5 Dbt Fing Instr\",\"series\":\"\",\"tlac_elig_fl\":\"\",\"div_stopper_fl\":\"\",\"facility\":\"\",\"ftt_liable_fl\":\"n\",\"next_par_call_px\":\"\",\"reoffered_dt\":\"\",\"src_of_pmt_cd\":\"\",\"over_subscription\":\"\",\"bailin_fl\":\"\",\"cur_rate_cd\":\"N\",\"flip_opt_cd\":\"IO\",\"cav_maturity_amt\":\"\",\"esg_compliance_cd\":\"\",\"ftt_report_fl\":\"n\",\"org_of_risk_id\":\"\",\"latest_iss_dt\":\"2018-08-27 00:00:00.0\",\"cur_amt_factor\":\"1.0\",\"security_cd\":\"\",\"odd_first_cpn_fl\":\"n\",\"div_pusher_fl\":\"\",\"ucits_compliance_fl\":\"\",\"prerefunded_fl\":\"\",\"structured_fl\":\"n\",\"term_to_maturity_yrs\":\"5Y\",\"reoffered_fl\":\"\",\"isa_eligible_fl\":\"n\",\"repo_elig_fl\":\"n\",\"rrps_ric_permid\":\"46667052112\",\"org_of_risk_audit_cd\":\"\",\"tier_capital_cd\":\"\",\"cic_cd\":\"CN29\",\"survivor_opt_fl\":\"n\",\"odd_last_cpn_cd\":\"R\",\"local_iss_dt\":\"\",\"write_down_trigg_ratio\":\"\",\"cdc_asset_class_cd\":\"MTN\",\"letter_of_credit_fl\":\"n\",\"structured_cd\":\"\",\"estimated_free_cnv_fl\":\"\",\"borrower_id\":\"\",\"cusip_change_dt\":\"\",\"finra_sub_prdct_type_cd\":\"\",\"solvability_ratio\":\"\",\"cleanup_call_fl\":\"n\",\"cntry_of_risk_cd\":\"\",\"cur_int_defer_fl\":\"n\",\"risk_classifications_cd\":\"\",\"trade_asset_type_cd\":\"\",\"make_whole_call_fl\":\"n\",\"write_down_fl\":\"\",\"issue_id\":\"\",\"esg_bond_fl\":\"n\",\"calc_disable_rsn\":\"\",\"qdi_elig_fl\":\"n\",\"write_down_type_cd\":\"\",\"super_sinker_fl\":\"\",\"asset_eff_dt\":\"2018-08-27 00:00:00.0\",\"realtime_building_block\":\"CORP\",\"pgm_iss_fl\":\"y\",\"addl_credit_fl\":\"\",\"mrel_elig_fl\":\"\",\"drd_elig_fl\":\"n\",\"cap_cont_fl\":\"n\"},\"asset\":{\"current_cpn\":\"8.5\",\"wpk_nm\":\"\",\"funged_fl\":\"n\",\"bankwatch_rating_dt\":\"\",\"latest_rating_src_cd\":\"\",\"asset_id\":\"0x00102caebb6f1554\",\"asset_status_cd\":\"DEF\",\"ibs_control_nm\":\"\",\"project_name\":\"\",\"emerging_market_fl\":\"n\",\"last_reset_dt\":\"\",\"mandatory_tender_dt\":\"\",\"mdy_rating_cd\":\"\",\"unit_cd\":\"\",\"next_sink_dt\":\"\",\"strip_total\":\"\",\"capitalization_fl\":\"n\",\"next_put_dt\":\"\",\"dom_settle_val\":\"1\",\"pay_freq_cd\":\"1\",\"mdy_rating_dt\":\"\",\"cur_prin_leg_nm\":\"1\",\"debt_svc_cd\":\"\",\"put_terms_fl\":\"y\",\"tot_prog_amt\":\"\",\"mdy_st_rtng_dt\":\"\",\"dcs_type_cd\":\"B\",\"next_pay_dt\":\"\",\"asset_setup_dt\":\"2018-08-23 02:39:00.0\",\"cur_amt_outsd\":\"700000.0\",\"trace_cd\":\"N\",\"next_reset_dt\":\"\",\"strippable_fl\":\"n\",\"day_count_cd\":\"5\",\"ibca_rating_dt\":\"\",\"rtfi_us_elig_cd\":\"SEA\",\"tap_end_dt\":\"\",\"status_of_document\":\"2\",\"exdiv_val\":\"\",\"asset_duplicate_cd\":\"\",\"valoren_nm\":\"\",\"life_cap\":\"\",\"pay_in_part_fl\":\"n\",\"oid_fl\":\"\",\"prospectus_dt\":\"2018-08-27 00:00:00.0\",\"mdy_watch_cd\":\"\",\"credit_sensitive_fl\":\"n\",\"dp_rating_dt\":\"\",\"lead_undwrt_cd\":\"\",\"sp_rating_cd\":\"\",\"clawback_type_cd\":\"\",\"min_denom\":\"100.0\",\"call_terms_fl\":\"n\",\"call_type_cd\":\"\",\"mdy_watch_dt\":\"\",\"sp_st_rtng_cd\":\"\",\"nsin_nm\":\"CND10001ZXY6\",\"float_mult\":\"\",\"min_credit_rating_cd\":\"AA-\",\"native_yld_type_cd\":\"CB\",\"asset_ticker\":\"OWREP\",\"fitch_rating_cd\":\"\",\"asset_templt_cd\":\"CC\",\"bankwatch_rating_cd\":\"\",\"annuity_fl\":\"n\",\"cpn_type_cd\":\"FXPV\",\"refund_dt\":\"\",\"status_eff_dt\":\"2021-08-29 00:00:00.0\",\"convertible_fl\":\"n\",\"tap_issue_fl\":\"n\",\"asset_permid\":\"192809957069\",\"latest_rating_eff_dt\":\"\",\"cur_amt_outsd_chg_cd\":\"ISS\",\"prosp_on_file_fl\":\"y\",\"sovr_class_cd\":\"\",\"sp_watch_dt\":\"\",\"dom_settle_cal_cd\":\"BDY\",\"last_cpn_dt\":\"2022-08-29 00:00:00.0\",\"redemption_val\":\"100.0\",\"orig_iss_dt\":\"2018-08-27 00:00:00.0\",\"record_dt_val\":\"\",\"stick_suppl_fl\":\"n\",\"exdiv_cal_cd\":\"\",\"multistep_flt_fl\":\"n\",\"dp_rating_cd\":\"\",\"float_offset\":\"\",\"cur_prin_curr_cd\":\"CNY\",\"secondary_insu_fl\":\"\",\"issuer_id\":\"0x000405016f81ce20\",\"record_dt_cd\":\"\",\"common_code_nm\":\"\",\"next_sink_amt\":\"\",\"orig_amt_iss\":\"700000.0\",\"series\":\"\",\"fitch_ibca_rating_cd\":\"\",\"tax_call_fl\":\"n\",\"asset_cf_corr_dt\":\"\",\"descr_detail\":\"\",\"er_score\":\"4\",\"prosp_suppl_dt\":\"\",\"rrps_ric\":\"CN101800969=RRPS\",\"domin_rating_cd\":\"\",\"exch_listed_fl\":\"y\",\"ibca_rating_cd\":\"\",\"next_call_px\":\"\",\"primary_quote_id\":\"00102C6F478A158B\",\"fitch_rating_dt\":\"\",\"cusip\":\"001765AG1\",\"pik_inkind_pmt_dt\":\"\",\"tax_status_cd\":\"\",\"equity_clawback_fl\":\"n\",\"amt_iss_tot\":\"700000.0\",\"next_call_dt\":\"\",\"physical_form_cd\":\"BKE\",\"isin_nm\":\"CND10001ZXY6\",\"mtn_shelf_id\":\"0x00102c40d75f0df9\",\"full_bridge_symbol\":\"cn*;OWREP-8.5-0823\",\"pik_fl\":\"n\",\"ds_subtype_cd\":\"CFIN\",\"life_floor\":\"\",\"domin_rating_dt\":\"\",\"fitch_ibca_rating_dt\":\"\",\"pay_cal_cd\":\"CDM\",\"first_cpn_dt\":\"2019-08-29 00:00:00.0\",\"maturity_dt\":\"2023-08-29 00:00:00.0\",\"dual_cur_fl\":\"n\",\"first_reset_dt\":\"\",\"cur_int_leg_nm\":\"1\",\"next_put_px\":\"\",\"distribution_src_cd\":\"RTRI\",\"perpetual_fl\":\"n\",\"cpn_class_cd\":\"FIX\",\"latest_rating_cd\":\"\",\"sp_st_rtng_dt\":\"\",\"bridge_symbol\":\"OWREP-8.5-0823\",\"dbs_pid\":\"110000B0313QH\",\"int_idx_lnk_fl\":\"\",\"float_index\":\"\",\"debt_type_cd\":\"SRNT\",\"prosp_suppl_nm\":\"\",\"sec_class_cd\":\"\",\"descr\":\"OWREP  8.500 08/29/23 MTN DFTd\",\"sp_watch_cd\":\"\",\"cntry_of_iss_cd\":\"CN\",\"sp_rating_dt\":\"\",\"eusd_tax_fl\":\"y\",\"currency_cd\":\"CNY\",\"withholding_tax\":\"\",\"orig_dated_dt\":\"2018-08-29 00:00:00.0\",\"exec_quote_fl\":\"n\",\"warrants_fl\":\"n\",\"sp_debt_class_cd\":\"\",\"private_place_fl\":\"n\",\"nsin_agn_cd\":\"ISN\",\"mtn_fl\":\"y\",\"denom_type_cd\":\"BKE\",\"euroclear_nm\":\"\",\"poison_put_fl\":\"n\",\"isin_src_cd\":\"\",\"trace_grade_cd\":\"\",\"asset_subtype_cd\":\"DMTC\",\"amt_iss_public\":\"\",\"asset_type_cd\":\"CORP\",\"defeased_fl\":\"n\",\"settle_bus_ctr_cd\":\"CN\",\"float_formula\":\"\",\"asset_last_chg_dt\":\"2023-03-06 17:49:00.0\",\"standard_yld_type_cd\":\"IS\",\"denom_incr\":\"100.0\",\"asset_info_src_cd\":\"RTR\",\"mdy_st_rtng_cd\":\"\",\"spec_put_fl\":\"n\",\"prin_idx_lnk_fl\":\"n\",\"guarantee_fl\":\"n\",\"pay_cal_val\":\"29\",\"fund_terms_fl\":\"n\",\"mdy_debt_class_cd\":\"\",\"pik_csh_pmt_dt\":\"\",\"bank_qualified_fl\":\"\",\"exp_maturity_dt\":\"\",\"secured_fl\":\"n\",\"for_settle_val\":\"\",\"next_mand_tender_dt\":\"\",\"fig_rule_cd\":\"C\",\"rtr_ticker\":\"OWREP\",\"rcs_class_cd\":\"BOND\",\"extend_terms_fl\":\"n\",\"preferred_ric\":\"CN101800969=\",\"ds_type_cd\":\"CORP\",\"inflation_protect_fl\":\"n\",\"cur_amt_out_dt\":\"2018-08-27 00:00:00.0\"}}}";
		String muniFeedJson = "{\"muni\":{\"rduSecurities\":[{\"security\":{\"quote\":{\"pe\":\"907\",\"quote_id\":\"0x001055d3680802f4\",\"currency_cd\":\"COP\",\"quote_permid\":\"47734858686\",\"asset_id\":\"0x00102caebb6f1554\",\"idn_contrib_cd\":\"PIPC\",\"price_src_cd\":\"SJO\",\"active_fl\":\"y\"},\"id_obj_xref_hist\":[{\"primary_fl\":\"\",\"end_dt\":\"\",\"id_upper\":\"COB61CD3EVR5=PIPC\",\"obj_oid\":\"0x001055d3680802f4\",\"id_type_cd\":\"RIC\",\"current_fl\":\"y\",\"id_scope_id\":\"\",\"eff_dt\":\"2023-01-31 00:00:00.0\",\"obj_type_cd\":\"GCQU\",\"id_value\":\"COB61CD3EVR5=PIPC\",\"global_region_cd\":\"N\"}]}},{\"security\":{\"quote\":{\"pe\":\"968\",\"quote_id\":\"0x001055db5e810243\",\"currency_cd\":\"COP\",\"quote_permid\":\"47735309481\",\"asset_id\":\"0x00102caebb6f1554\",\"idn_contrib_cd\":\"INFV\",\"price_src_cd\":\"NNX\",\"active_fl\":\"y\"},\"id_obj_xref_hist\":[{\"primary_fl\":\"\",\"end_dt\":\"\",\"id_upper\":\"COB61CD3EVR5=INFV\",\"obj_oid\":\"0x001055db5e810243\",\"id_type_cd\":\"RIC\",\"current_fl\":\"y\",\"id_scope_id\":\"\",\"eff_dt\":\"2023-01-31 00:00:00.0\",\"obj_type_cd\":\"GCQU\",\"id_value\":\"COB61CD3EVR5=INFV\",\"global_region_cd\":\"N\"}]}},{\"security\":{\"quote\":{\"pe\":\"\",\"quote_id\":\"0x001055fca3f301e8\",\"currency_cd\":\"\",\"quote_permid\":\"47734787655\",\"asset_id\":\"0x00102caebb6f1554\",\"idn_contrib_cd\":\"\",\"price_src_cd\":\"EJV\",\"active_fl\":\"y\"},\"id_obj_xref_hist\":[{\"primary_fl\":\"\",\"end_dt\":\"\",\"id_upper\":\"COB61CD3EVR5=RRPS\",\"obj_oid\":\"0x001055fca3f301e8\",\"id_type_cd\":\"RIC\",\"current_fl\":\"y\",\"id_scope_id\":\"\",\"eff_dt\":\"2023-01-31 00:00:00.0\",\"obj_type_cd\":\"GCQU\",\"id_value\":\"COB61CD3EVR5=RRPS\",\"global_region_cd\":\"N\"}]}},{\"security\":{\"quote\":{\"pe\":\"6897\",\"quote_id\":\"0x0010554da9f30153\",\"currency_cd\":\"COP\",\"quote_permid\":\"47734787727\",\"asset_id\":\"0x00102caebb6f1554\",\"idn_contrib_cd\":\"RRPS\",\"price_src_cd\":\"RRT\",\"active_fl\":\"y\"},\"id_obj_xref_hist\":[{\"primary_fl\":\"\",\"end_dt\":\"\",\"id_upper\":\"COB61CD3EVR5=RRPS\",\"obj_oid\":\"0x0010554da9f30153\",\"id_type_cd\":\"RIC\",\"current_fl\":\"y\",\"id_scope_id\":\"\",\"eff_dt\":\"2023-01-31 00:00:00.0\",\"obj_type_cd\":\"GCQU\",\"id_value\":\"COB61CD3EVR5=RRPS\",\"global_region_cd\":\"N\"}]}}],\"asset\":{\"asset_id\":\"0x00102caebb6f1554\"}}}";
		JSONObject feedJsonObj = JsonConverterUtil.convertToSimpleJson(muniFeedJson);
		JSONObject dbJsonObj = JsonConverterUtil.convertToSimpleJson(muniDbJson);
		Record feedRecord = new Record();
		feedRecord.getRecordRawData().setRawData(feedJsonObj);
		Record mergedRecord = feedVsDbMergeService.merge(feedRecord, dbJsonObj);
		assertNull(dbJsonObj.get("quote"));
		assertEquals("0x001055d3680802f4", mergedRecord.getRecordRawData().getRawDataAttribute("$.muni.rduSecurities[?(@.security.quote.quote_id == '0x001055d3680802f4')].security.id_obj_xref_hist[*].obj_oid"));
	}
	
	/*
	 * Test case to merge feed quote object with db quote object.
	 * Here, quote_permid from feed will merge with db object.
	 */
	@Test
	public void testMergeQuoteDelta() {
		String muniDbJson = "{\"muni\":{\"rduSecurities\":[{\"security\":{\"quote\":{\"pe\":\"907\",\"quote_id\":\"0x001055d3680802f4\",\"currency_cd\":\"COP\",\"quote_permid\":\"47734858686\",\"asset_id\":\"0x00102caebb6f1554\",\"idn_contrib_cd\":\"PIPC\",\"price_src_cd\":\"SJO\",\"active_fl\":\"y\"},\"id_obj_xref_hist\":[{\"primary_fl\":\"\",\"end_dt\":\"\",\"id_upper\":\"COB61CD3EVR5=PIPC\",\"obj_oid\":\"0x001055d3680802f4\",\"id_type_cd\":\"RIC\",\"current_fl\":\"y\",\"id_scope_id\":\"\",\"eff_dt\":\"2023-01-31 00:00:00.0\",\"obj_type_cd\":\"GCQU\",\"id_value\":\"COB61CD3EVR5=PIPC\",\"global_region_cd\":\"N\"}]}},{\"security\":{\"quote\":{\"pe\":\"968\",\"quote_id\":\"0x001055db5e810243\",\"currency_cd\":\"COP\",\"quote_permid\":\"47735309481\",\"asset_id\":\"0x00102caebb6f1554\",\"idn_contrib_cd\":\"INFV\",\"price_src_cd\":\"NNX\",\"active_fl\":\"y\"},\"id_obj_xref_hist\":[{\"primary_fl\":\"\",\"end_dt\":\"\",\"id_upper\":\"COB61CD3EVR5=INFV\",\"obj_oid\":\"0x001055db5e810243\",\"id_type_cd\":\"RIC\",\"current_fl\":\"y\",\"id_scope_id\":\"\",\"eff_dt\":\"2023-01-31 00:00:00.0\",\"obj_type_cd\":\"GCQU\",\"id_value\":\"COB61CD3EVR5=INFV\",\"global_region_cd\":\"N\"}]}},{\"security\":{\"quote\":{\"pe\":\"\",\"quote_id\":\"0x001055fca3f301e8\",\"currency_cd\":\"\",\"quote_permid\":\"47734787655\",\"asset_id\":\"0x00102caebb6f1554\",\"idn_contrib_cd\":\"\",\"price_src_cd\":\"EJV\",\"active_fl\":\"y\"},\"id_obj_xref_hist\":[{\"primary_fl\":\"\",\"end_dt\":\"\",\"id_upper\":\"COB61CD3EVR5=RRPS\",\"obj_oid\":\"0x001055fca3f301e8\",\"id_type_cd\":\"RIC\",\"current_fl\":\"y\",\"id_scope_id\":\"\",\"eff_dt\":\"2023-01-31 00:00:00.0\",\"obj_type_cd\":\"GCQU\",\"id_value\":\"COB61CD3EVR5=RRPS\",\"global_region_cd\":\"N\"}]}},{\"security\":{\"quote\":{\"pe\":\"6897\",\"quote_id\":\"0x0010554da9f30153\",\"currency_cd\":\"COP\",\"quote_permid\":\"47734787727\",\"asset_id\":\"0x00102caebb6f1554\",\"idn_contrib_cd\":\"RRPS\",\"price_src_cd\":\"RRT\",\"active_fl\":\"y\"},\"id_obj_xref_hist\":[{\"primary_fl\":\"\",\"end_dt\":\"\",\"id_upper\":\"COB61CD3EVR5=RRPS\",\"obj_oid\":\"0x0010554da9f30153\",\"id_type_cd\":\"RIC\",\"current_fl\":\"y\",\"id_scope_id\":\"\",\"eff_dt\":\"2023-01-31 00:00:00.0\",\"obj_type_cd\":\"GCQU\",\"id_value\":\"COB61CD3EVR5=RRPS\",\"global_region_cd\":\"N\"}]}}],\"asset\":{\"asset_id\":\"0x00102caebb6f1554\"}}}";
		String muniFeedJson = "{\"muni\":{\"rduSecurities\":[{\"security\":{\"quote\":{\"pe\":\"6897\",\"quote_id\":\"0x001055d3680802f4\",\"currency_cd\":\"COP\",\"quote_permid\":\"47734787727\",\"asset_id\":\"0x00102caebb6f1554\",\"idn_contrib_cd\":\"RRPS\",\"price_src_cd\":\"RRT\",\"active_fl\":\"y\"},\"id_obj_xref_hist\":[{\"primary_fl\":\"\",\"end_dt\":\"\",\"id_upper\":\"COB61CD3EVR5=RRPP\",\"obj_oid\":\"0x001055d3680802f4\",\"id_type_cd\":\"RIC\",\"current_fl\":\"y\",\"id_scope_id\":\"\",\"eff_dt\":\"2023-01-31 00:00:00.0\",\"obj_type_cd\":\"GCQU\",\"id_value\":\"COB61CD3EVR5=RRPP\",\"global_region_cd\":\"N\"}]}}],\"asset\":{\"asset_id\":\"0x00102caebb6f1553\"}}}";
		JSONObject feedJsonObj = JsonConverterUtil.convertToSimpleJson(muniFeedJson);
		JSONObject dbJsonObj = JsonConverterUtil.convertToSimpleJson(muniDbJson);
		Record feedRecord = new Record();
		feedRecord.getRecordRawData().setRawData(feedJsonObj);
		Record mergedRecord = feedVsDbMergeService.merge(feedRecord, dbJsonObj);
		assertEquals("47734787727", mergedRecord.getRecordRawData().getRawDataAttribute("$.muni.rduSecurities[?(@.security.quote.quote_id == '0x001055d3680802f4')].security.quote.quote_permid"));
	}

	
}
